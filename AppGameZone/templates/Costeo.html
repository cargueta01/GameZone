{% extends "base.html" %}

{% load static %}

{% block content %}

<body>
    <div class="container">

        <div class="py-5 text-center">
            <h2>Registrar un Costeo</h2>
        </div>

        <div class="container col-lg-8">
            <h4 class="mb-3">Formulario de Costeo</h4><br>


            <form class="needs-validation" enctype="multipart/form-data" method="post" novalidate>
                {% csrf_token %}
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="country" class="form-label">Cantidad de Materia Prima</label>
                        <input type="number" class="form-control" name="materiaPrima" step="0.01" required>
                        <div class="invalid-feedback">
                            Digite una cantidad
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label for="country" class="form-label">Costo Unitario de Materia Prima</label>
                        <input type="number" class="form-control" name="costoMateriaPrima" step="0.01" required>
                        <div class="invalid-feedback">
                            Digite un costo
                        </div>
                    </div>
                </div><br><br>

                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Cantidad de Mano de Obra</label>
                        <input type="number" class="form-control" name="manoDeObra" step="0.01" required>
                        <div class="invalid-feedback">
                            Digite una cantidad
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Costo Unitario de Mano de Obra</label>
                        <input type="number" class="form-control" name="costoManoDeObra" step="0.01" required>
                        <div class="invalid-feedback">
                            Digite un costo
                        </div>
                    </div>
                </div><br>

                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Tasa de CIF</label>
                        <input type="number" class="form-control" name="tasaCIF" step="0.01">
                        <div class="invalid-feedback">
                            Digite el porcentaje de cif
                        </div>
                    </div>
                </div><br>

                <div class="row g-3">
                    <div class="col-md-8">
                        <hr class="my-4">
                    </div>
                </div>

                <div class="row g-3">
                    <div class="col-md-2"></div>
                    <div class="col-md-4">
                        <button class="w-100 btn btn-primary btn-lg" type="submit" name="agregar">Agregar
                            Costeo</button>
                    </div>
                </div>
            </form>
        </div><br><br><br><br>

        <div class="row">
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th colspan="2" style="text-align: center; background-color:cadetblue">
                                <button type="button" name="mostrar" id="calcularTotales"
                                    style="text-align: center; background-color:cadetblue" class="btn">Costeo</button>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Total materia prima </td>
                            <td id="totalMateriaPrima">valor</td>
                        </tr>
                        <tr>
                            <td>Total mano de obra directa</td>
                            <td id="totalManoDeObra">valor</td>
                        </tr>
                        <tr>
                            <td>Costos indirectos de fabricacion</td>
                            <td id="totalFabicacion">valor</td>
                        </tr>
                        <tr>
                            <td>Costo total de la orden</td>
                            <td id="totalOrden">valor</td>
                        </tr>
                        <tr>
                            <td>Costo unitario</td>
                            <td id="totalCostoUnitario">valor</td>
                        </tr>
                        <tr>
                            <td>Precio de venta</td>
                            <td id="precioVenta">valor</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
    <script src="../static/bootstrap/js/form-validation.js"></script>
    <script>
        document.getElementById('calcularTotales').addEventListener('click', function () {
            var costeo = JSON.parse('{{ costeo | safe }}'); // Convierte el objeto Python a JavaScript
            if (costeo.length === 0) {
                // No hay datos, establece todos los totales en cero
                var totalMateriaPrima = 0;
                var totalManoDeObra = 0;
                var totalFabicacion = 0;
                var totalOrden = 0;
                var totalCostoUnitario = 0;
                var precioVenta = 0;
            } else {
                var totalMateriaPrima = costeo.reduce(function (acc, item) {
                    return acc + (item.materiaPrima * item.costoMateriaPrima);
                }, 0);

                var totalManoDeObra = costeo.reduce(function (acc, item) {
                    return acc + (item.manoDeObra * item.costoManoDeObra);
                }, 0);
                var tasaCIF = costeo[0].tasaCIF / 100;

                var totalFabicacion = totalManoDeObra * tasaCIF;
                var totalOrden = totalMateriaPrima + totalManoDeObra + totalFabicacion;
                var totalCostoUnitario = totalOrden / 1;
                var precioVenta = totalOrden + (totalOrden * 0.1012085);
            }
            // Actualiza los elementos en tu HTML con los nuevos valores
            document.getElementById('totalMateriaPrima').textContent = totalMateriaPrima.toFixed(2);
            document.getElementById('totalManoDeObra').textContent = totalManoDeObra.toFixed(2);
            document.getElementById('totalFabicacion').textContent = totalFabicacion.toFixed(2);
            document.getElementById('totalOrden').textContent = totalOrden.toFixed(2);
            document.getElementById('totalCostoUnitario').textContent = totalCostoUnitario.toFixed(2);
            document.getElementById('precioVenta').textContent = precioVenta.toFixed(2);
        });
        console.log("se ejecuto la funcion")
    </script>
</body>

{% endblock %}